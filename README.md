# Otus.HomeWork.TPL
Курс C# Professional от OTUS. Домашняя работа:TPL, gRPC,Kafka.

## Цель:
Закрепить на практике навыки работы с брокером сообщений Kafka, gRPC и TPL (Task Parallel Library).

Применение разных способов распараллеливания задач и оценка оптимального способа реализации.

## Задание:

Напишите вычисление суммы элементов массива интов:

1) Последовательное вычисление суммы элементов коллекции.

2) Вычисление суммы элементов коллекции через Parallel LINQ.

3) Вычисление суммы элементов коллекции через TPL + locker.
   
4) Вычисление суммы элементов коллекции через TPL + interlocked.

Замерьте время выполнения для 100 000, 1 000 000 и 10 000 000.

Укажите в таблице результаты замеров, указав:

 1) Время выполнения последовательного вычисления.

 2) Время выполнения параллельного вычисления.

 3) Время выполнения LINQ.

## Описание реализованного функционала:
В проекте применена микросервисная архитектура.
Каждый микросервис выполнен в Onion-архитекруре.

### Микросервис "ConsoleClientApp":
Предназначен для взаимодействия с клиентом приложения.

"ConsoleClientApp" реализован в виде консольного приложения, служит клиентской частью всего проекта.

Также выступает в роли "Producer" для брокера сообщений "Kafka". 

Данные, которые ввел пользователь (числа массива) отправляет в микросервис "GrpcMathService" и получает ответ, который выводит клиенту для определения дальнейших действий.

Общение "ConsoleClientApp" с "GrpcMathService" реализовано с помощью gRPC.

При выборе пользователем пункта меню "Сохранить результаты расчёта", "ConsoleClientApp" отправляет данные в топик брокера сообщений "Kafka", который читает микросервис "GrpcWithDbService".

Информацию о выполненных ранее замерах времени подсчёта суммы массива, "ConsoleClientApp" запрашивает так же у микросервиса "GrpcWithDbService" с помощью gRPC.

### Микросервис "GrpcMathService":
Предназначен для подсчёта суммы элементов массива для 100 000, 1000 000 и 10 000 000 итераций.

"GrpcMathService" реализован в виде ASP.NET Core gRPC Service приложения.

Oбщение "GrpcMathService" c "ConsoleClientApp" реализовано с помощью gRPC.

### Микросервис "GrpcWithDbService":
Предназначен для сохранения результатов расчётов и получения истории расчётов.

"GrpcWithDbService" реализован в виде ASP.NET Core gRPC Service.

Также выступает в роли "Consumer" топика брокера сообщений "Kafka", в который отправляет данные микросервис "ConsoleClientApp".

Полученные данные сохраняются в бд PostgreSql c помощью EntityFrameWork Core.

Обмен данными по выполненным ранее расчётам между микросервисами "GrpcWithDbService" и "ConsoleClientApp" реализован через gRPC.

## Работа программы:
Пользователь вводит любое количество чисел:

![alt text](https://github.com/E-A-Volobuev/Otus.HomeWork.TPL/blob/master/StartGame.png)

По завершению ввода чисел нажимает латинскую букву "E" (регистр неважен).

После чего запрос с введёнными данными отправляется с помощью gRPC в микросервис "GrpcMathService". Данные обрабатываются и "GrpcMathService" отдает ответ:

![alt text](https://github.com/E-A-Volobuev/Otus.HomeWork.TPL/blob/master/GameResult.png)

При выборе "Нет" пользователь вернется в главное меню с выбором действий.

При выборе "Да" данные, полученные микросервисом "ConsoleClientApp" от "GrpcMathService" отправляются в топик брокера сообщений "Kafka", который читает микросервис "GrpcWithDbService":

![alt text](https://github.com/E-A-Volobuev/Otus.HomeWork.TPL/blob/master/KafkaResults.png)

Микросервис "GrpcWithDbService" , получив данные из топика брокера сообщений "Kafka", сохраняет их в свою бд PostrgeSql

![alt text](https://github.com/E-A-Volobuev/Otus.HomeWork.TPL/blob/master/DbResult.png)

При получении запроса через gRPC от микросервиса "ConsoleClientApp" на вывод истории расчётов клиенту, "GrpcWithDbService" отправляет данные, полученные из бд

![alt text](https://github.com/E-A-Volobuev/Otus.HomeWork.TPL/blob/master/GetAllResults.png)
